<!DOCTYPE html>
<html lang="en">

<head>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2&display=swap" rel="stylesheet">
    <style>
        /* Base Styling */
        body {
            font-family: 'Baloo 2', cursive;
            background-color: #fdf6ec;
            background-image: radial-gradient(circle at top left, #fff7e8 0%, #fdf6ec 100%);
            background-size: cover;
            background-position: center;
            margin: 0;
            padding: 0;
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Heading */
        h1 {
            text-align: center;
            color: #ff6f61;
            font-size: 42px;
            margin: 40px 0 20px;
        }

        /* Container Styling */
        .container {
            width: 90%;
            max-width: 1000px;
            margin: auto;
            padding: 20px;
            text-align: center;
        }

        /* Navigation Links Styling */
        .nav-links {
            text-align: center;
            margin-bottom: 30px;
        }

        .nav-links a {
            text-decoration: none;
            color: #118ab2;
            font-size: 18px;
            margin: 0 15px;
            font-weight: bold;
        }

        .nav-links a:hover {
            color: #06d6a0;
        }

        /* Assessment Box Styling */
        .assessment {
            width: 100%;
    padding: 14px;
    margin: 10px 0; /* Ensure consistent margin */
    font-size: 16px;
    border-radius: 10px;
    border: 2px solid #ccc;
    background-color: #f9f9f9;
    box-sizing: border-box;
    transition: 0.3s;
        }

        .assessment:nth-of-type(odd) {
            background-color: #fff7eb;
        }

        .assessment h2 {
            color: #ff6f61;
            font-size: 30px;
            margin-bottom: 15px;
        }

        .assessment p {
            font-size: 18px;
            line-height: 1.6;
            color: #555;
        }
        .assessment {
    overflow: hidden; /* Prevents elements from spilling out */
}

        /* Activity Section Styling */
        .activity {
    margin-top: 25px;
    margin-bottom: 25px; /* Control spacing between activities */
}

.question-section {
    margin-bottom: 15px; /* Prevent large gaps between text areas */
}

        h3 {
            font-size: 22px;
            color: #118ab2;
            margin-bottom: 10px;
        }

        /* Input Box Styling */
        .input-box,
        textarea {
            width: 100%;
            padding: 14px;
            margin: 10px 0;
            font-size: 16px;
            border-radius: 10px;
            border: 2px solid #ccc;
            background-color: #f9f9f9;
            box-sizing: border-box;
            transition: 0.3s;
        }

        .input-box:focus,
        textarea:focus {
            border-color: #06d6a0;
            box-shadow: 0 0 5px rgba(6, 214, 160, 0.3);
            outline: none;
        }

        /* Button Styling */
        .button,
        .yes-no-btns button {
            background-color: #06d6a0;
            color: white;
            padding: 12px 22px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-top: 10px;
        }

        .button:hover,
        .yes-no-btns button:hover {
            background-color: #05b38c;
        }

        /* Feedback Message Styling */
        .feedback {
            display: none;
            margin-top: 15px;
            padding: 12px;
            font-weight: bold;
            border-radius: 8px;
            font-size: 16px;
        }

        .feedback.correct {
            background-color: #d4edda;
            color: #155724;
            border-left: 6px solid #28a745;
        }

        .feedback.incorrect {
            background-color: #f8d7da;
            color: #721c24;
            border-left: 6px solid #dc3545;
        }

        /* Section Divider */
        .section-divider {
            height: 1px;
            background-color: #eee;
            border-radius: 2px;
            margin: 20px 0;
        }

        /* Label Styling */
        label {
            font-weight: bold;
            font-size: 16px;
            color: #118ab2;
        }

        /* Media Queries for Responsiveness */
        @media (max-width: 600px) {
            body {
                font-size: 14px;
            }

            h1 {
                font-size: 32px;
            }

            .input-box,
            textarea {
                font-size: 15px;
                padding: 12px;
            }

            .button,
            .yes-no-btns button {
                font-size: 15px;
                padding: 10px 18px;
            }

            .assessment h2 {
                font-size: 26px;
            }

            .activity h3 {
                font-size: 20px;
            }
        }
        .progress-bar-container {
            width: 100%;
            background-color: #eee;
            border-radius: 8px;
            height: 20px;
            margin: 20px 0;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: #06d6a0;
            border-radius: 8px;
        }

        /* Feedback Styling */
        .feedback {
            margin-top: 10px;
            font-weight: bold;
        }

        .correct {
            color: green;
        }

        .incorrect {
            color: red;
        }
    </style>
</head>

    <div class="container">
        <h1>üìö Assessment Page</h1>

          <!-- Progress Bar -->
          <div class="progress-bar-container">
            <div id="progressBar" class="progress-bar"></div>
        </div>
          </div>          

        <!-- Let's Go Visit Thailand Activity -->
        <div class="assessment">
            <h2>Let's Go Visit Thailand</h2>
            <p>The story of <strong>Let's Go Visit Thailand</strong> takes us on an exciting journey to a beautiful country, exploring its culture, cuisine, and landmarks. Read through the questions below based on the story.</p>
            <!-- Activities here -->

            <div class="activity">
                <h3>üî§ Jumbled Word</h3>
                <p>Rearrange the jumbled letters to form a word: <strong>TALNADIH</strong></p>
                <input type="text" id="jumbledThailand" class="input-box" placeholder="Type the word here">
                <button class="button" onclick="checkJumbledWord('thailand', 'jumbledThailand', 'thailandFeedback', 'Jumbled Word - Thailand')">‚úÖ Submit</button>
                <div id="thailandFeedback" class="feedback"></div>
            </div>

            <div class="activity">
                <h3>üìò Definition of Terms</h3>
                <div class="question-section">
                    <label for="word1Thailand">Word 1: <strong>Culture</strong></label><br>
                    <textarea id="word1Thailand" class="input-box" placeholder="Write the definition for Culture"></textarea>
                </div>
                <div class="question-section">
                    <label for="word2Thailand">Word 2: <strong>Cuisine</strong></label><br>
                    <textarea id="word2Thailand" class="input-box" placeholder="Write the definition for Cuisine"></textarea>
                </div>
                <button class="button" onclick="submitDefinitions('word1Thailand', 'word2Thailand', 'thailandDefinitionFeedback', 'Definitions - Thailand')">‚úÖ Submit Definitions</button>
                <div id="thailandDefinitionFeedback" class="feedback"></div>
            </div>

            <div class="activity">
                <h3>‚úçÔ∏è Fill in the Blank</h3>
                <p>1. Thailand is famous for its delicious __________. (Hint: food)</p>
                <input type="text" id="fillThailandBlank" class="input-box" placeholder="Type the word here">
                <button class="button" onclick="checkFillInBlank('cuisine', 'fillThailandBlank', 'thailandFillBlankFeedback', 'Fill in the Blank - Thailand')">‚úÖ Submit</button>
                <div id="thailandFillBlankFeedback" class="feedback"></div>
            </div>
            
            <div class="activity">
               
        </div>

        <div class="section-divider"></div>

        <!-- The Stonecutter Activity -->
        <div class="assessment">
            <h2>ü™® Stonecutter</h2>
            <p>The story of <strong>The Stonecutter</strong> shows the importance of being content with one's life. Read through the questions below based on the story.</p>
            <div class="activity">
                <h3>üî§ Jumbled Word</h3>
                <p>Rearrange the jumbled letters to form a word: <strong>ERTSTNEOCUT</strong></p>
                <input type="text" id="jumbledStonecutter" class="input-box" placeholder="Type the word here">
                <button class="button" onclick="checkJumbledWord('stonecutter', 'jumbledStonecutter', 'stonecutterFeedback', 'Jumbled Word - Stonecutter')">‚úÖ Submit</button>
                <div id="stonecutterFeedback" class="feedback"></div>
            </div>
        
            <div class="activity">
                <h3>üìò Definition of Terms</h3>
                <div class="question-section">
                    <label for="word1Stonecutter">Word 1: <strong>Envy</strong></label><br>
                    <textarea id="word1Stonecutter" class="input-box" placeholder="Write the definition for Envy"></textarea>
                </div>
                <div class="question-section">
                    <label for="word2Stonecutter">Word 2: <strong>Contentment</strong></label><br>
                    <textarea id="word2Stonecutter" class="input-box" placeholder="Write the definition for Contentment"></textarea>
                </div>
                <button class="button" onclick="submitDefinitions('word1Stonecutter', 'word2Stonecutter', 'stonecutterDefinitionFeedback', 'Definitions - Stonecutter')">‚úÖ Submit Definitions</button>
                <div id="stonecutterDefinitionFeedback" class="feedback"></div>
            </div>
        
            <div class="activity">
                <h3>‚úçÔ∏è Fill in the Blank</h3>
                <p>1. The stonecutter wished for more power out of __________. (Hint: a feeling of desire)</p>
                <input type="text" id="fillStonecutterBlank" class="input-box" placeholder="Type the word here">
                <button class="button" onclick="checkFillInBlank('envy', 'fillStonecutterBlank', 'stonecutterFillBlankFeedback', 'Fill in the Blank - Stonecutter')">‚úÖ Submit</button>
                <div id="stonecutterFillBlankFeedback" class="feedback"></div>
            </div>
        
            <div class="activity">
                
    </div>

        <div class="section-divider"></div>

        <!-- The Rescued Pet Activity -->
        <div class="assessment">
            <h2>üêæ The Rescued Pet</h2>
            <p>The story of <strong>The Rescued Pet</strong> emphasizes the importance of rescuing animals and giving them a loving home. Read through the questions below based on the story.</p>
            <div class="activity">
                <h3>üî§ Jumbled Word</h3>
                <p>Rearrange the jumbled letters to form a word: <strong>TEP</strong></p>
                <input type="text" id="jumbledPet" class="input-box" placeholder="Type the word here">
                <button class="button" onclick="checkJumbledWord('pet', 'jumbledPet', 'petFeedback', 'Jumbled Word - Pet')">‚úÖ Submit</button>
                <div id="petFeedback" class="feedback"></div>
            </div>
        
            <div class="activity">
                <h3>üìò Definition of Terms</h3>
                <div class="question-section">
                    <label for="word1Pet">Word 1: <strong>Adopt</strong></label><br>
                    <textarea id="word1Pet" class="input-box" placeholder="Write the definition for Adopt"></textarea>
                </div>
                <div class="question-section">
                    <label for="word2Pet">Word 2: <strong>Rescue</strong></label><br>
                    <textarea id="word2Pet" class="input-box" placeholder="Write the definition for Rescue"></textarea>
                </div>
                <button class="button" onclick="submitDefinitions('word1Pet', 'word2Pet', 'petDefinitionFeedback', 'Definitions - Pet')">‚úÖ Submit Definitions</button>
                <div id="petDefinitionFeedback" class="feedback"></div>
            </div>
        
            <div class="activity">
                <h3>‚úçÔ∏è Fill in the Blank</h3>
                <p>1. Adopting a __________ from the pound is a great way to help an animal in need. (Hint: pet)</p>
                <input type="text" id="fillPetBlank" class="input-box" placeholder="Type the word here">
                <button class="button" onclick="checkFillInBlank('pet', 'fillPetBlank', 'petFillBlankFeedback', 'Fill in the Blank - Pet')">‚úÖ Submit</button>
                <div id="petFillBlankFeedback" class="feedback"></div>
            </div>
        
           
    </div>
</body>
</html>

    <!-- Progress Bar -->
    <div id="progressBarContainer" style="width: 100%; background-color: #f3f3f3;">
        <div id="progressBar"></div>
    </div>
    
    <!-- Buttons -->
    <button class="button" onclick="calculateTotalScore()">Show Total Score</button>
    <button class="button" onclick="displayResults()">Show Assessment Results</button>
    <button id="goToAdditional" class="button" disabled>Go To Additional Assessment</button>
    <button id="goToKnowledgeQuest" class="button" disabled>Go To Knowledge Quest</button>    
    

    <script>
        let assessmentsCompleted = 0;
        const completedAssessments = new Set(); // To avoid double-counting
    
        const totalAssessments = 6; // Adjust this if the total number of tasks changes
    
        // Function to update progress bar
        function updateProgressBar() {
    const progressBar = document.getElementById('progressBar');
    const percentage = (assessmentsCompleted / totalAssessments) * 100;
    progressBar.style.width = `${percentage}%`;

    if (assessmentsCompleted === totalAssessments) {
        enableButtons(); // Enable buttons once all tasks are complete
    }
}

    
        // Function to mark assessment as completed
        function markAssessmentCompleted(assessmentKey) {
            if (!completedAssessments.has(assessmentKey)) {
                completedAssessments.add(assessmentKey);
                assessmentsCompleted++;
                updateProgressBar();
            }
        }
    
        // Function to save assessment results to localStorage
        function saveAssessmentResult(assessment, result) {
            const results = JSON.parse(localStorage.getItem('assessmentResults')) || [];
            results.push({ assessment, result });
            localStorage.setItem('assessmentResults', JSON.stringify(results));
        }
    
        // Functions to handle different types of questions
        function checkJumbledWord(correctAnswer, inputId, feedbackId, assessmentKey) {
            const answer = document.getElementById(inputId).value.toLowerCase();
            const feedback = document.getElementById(feedbackId);
    
            if (answer === correctAnswer) {
                feedback.textContent = "Correct!";
                feedback.className = "correct";
                saveAssessmentResult(assessmentKey, 'Correct');
                markAssessmentCompleted(assessmentKey);
            } else {
                feedback.textContent = `Incorrect. The correct answer is ${correctAnswer}.`;
                feedback.className = "incorrect";
                saveAssessmentResult(assessmentKey, 'Incorrect');
            }
            feedback.style.display = 'block';
        }
    
        // 1. Check definition accuracy using DictionaryAPI
async function checkDefinitionAccuracy(word, userDefinition) {
    try {
        const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word.toLowerCase()}`);
        if (!response.ok) return false;

        const data = await response.json();
        const actualDefinition = data[0]?.meanings?.[0]?.definitions?.[0]?.definition?.toLowerCase();

        return userDefinition.toLowerCase().includes(actualDefinition);
    } catch (error) {
        console.error("Error fetching from Dictionary API:", error);
        return false;
    }
}
// Softer definition matcher: checks if ANY keyword in the dictionary definition is included
async function checkDefinitionSoftMatch(word, userDefinition) {
    try {
        const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word.toLowerCase()}`);
        if (!response.ok) return false;

        const data = await response.json();
        const actualDefinition = data[0]?.meanings?.[0]?.definitions?.[0]?.definition?.toLowerCase();

        if (!actualDefinition) return false;

        const importantWords = actualDefinition
            .split(/\s+/)
            .filter(word => word.length > 4 && !['being', 'means', 'thing'].includes(word)); // ignore basic words

        const matches = importantWords.filter(w => userDefinition.toLowerCase().includes(w));
        return matches.length >= 2;
    } catch (error) {
        console.error("Soft match failed:", error);
        return false;
    }
}



// 2. Check grammar using LanguageTool API
async function checkGrammar(text) {
    const params = new URLSearchParams({
        text: text,
        language: "en-US"
    });

    const response = await fetch("https://api.languagetool.org/v2/check", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: params.toString()
    });

    const data = await response.json();
    return data.matches; // Array of grammar issues
}
// Mapping between textarea IDs and expected keywords
const wordMap = {
    word1Thailand: "culture",
    word2Thailand: "cuisine",
    word1Stonecutter: "envy",
    word2Stonecutter: "contentment",
    word1Pet: "adopt",
    word2Pet: "rescue"
};

async function submitDefinitions(word1Id, word2Id, feedbackId, assessmentKey) {
    const def1 = document.getElementById(word1Id).value.trim();
    const def2 = document.getElementById(word2Id).value.trim();
    const feedback = document.getElementById(feedbackId);
    feedback.style.display = 'block';

    if (!def1 || !def2) {
        feedback.textContent = '‚ùå Oops! Please complete both definitions so we can check them.';
        feedback.className = "feedback incorrect";
        saveAssessmentResult(assessmentKey, 'Incomplete');
        return;
    }

    const word1 = wordMap[word1Id];
    const word2 = wordMap[word2Id];

    // Check accuracy
    const match1 = await checkDefinitionSoftMatch(word1, def1);
    const match2 = await checkDefinitionSoftMatch(word2, def2);

    // Check grammar
    const grammar1 = await checkGrammar(def1);
    const grammar2 = await checkGrammar(def2);
    const totalGrammarIssues = grammar1.length + grammar2.length;

    let message = "";
    let allGood = match1 && match2 && totalGrammarIssues <= 2;

    if (allGood) {
        message = "üéâ Awesome work! Both definitions are accurate and well written.";
        feedback.className = "feedback correct";
        saveAssessmentResult(assessmentKey, 'Correct');
        markAssessmentCompleted(assessmentKey);
    } else {
        message = "‚úÖ Thanks for your effort! Here's some helpful feedback:\n";

        if (!match1) {
            message += `‚Ä¢ The definition for **${word1}** could be clearer or more accurate.\n`;
        } else {
            message += `‚Ä¢ ‚úÖ Your definition for **${word1}** looks good!\n`;
        }

        if (!match2) {
            message += `‚Ä¢ The definition for **${word2}** might need a little improvement.\n`;
        } else {
            message += `‚Ä¢ ‚úÖ Great job with **${word2}**!\n`;
        }

        if (totalGrammarIssues > 2) {
            message += `‚Ä¢ ‚úçÔ∏è There are some grammar mistakes (about ${totalGrammarIssues}). Try to revise a bit.\n`;
        } else if (totalGrammarIssues > 0) {
            message += `‚Ä¢ üîç A couple of small grammar issues were found. Almost perfect!\n`;
        }

        feedback.className = "feedback incorrect";
        saveAssessmentResult(assessmentKey, 'Needs Review');
    }

    feedback.textContent = message;
}

function checkFillInBlank(correctAnswer, inputId, feedbackId, assessmentKey) {
    const answer = document.getElementById(inputId).value.toLowerCase();
    const feedback = document.getElementById(feedbackId);

    if (answer === correctAnswer.toLowerCase()) {
        feedback.textContent = 'Correct!';
        feedback.className = "correct";
        saveAssessmentResult(assessmentKey, 'Correct');
        markAssessmentCompleted(assessmentKey);
    } else {
        feedback.textContent = `Incorrect. The correct answer is ${correctAnswer}.`;
        feedback.className = "incorrect";
        saveAssessmentResult(assessmentKey, 'Incorrect');
    }

    feedback.style.display = 'block';
}

        // Function to calculate total score from localStorage results
        function calculateTotalScore() {
            const results = JSON.parse(localStorage.getItem('assessmentResults')) || [];
            const score = results.reduce((total, result) => total + (result.result === 'Correct' ? 1 : 0), 0);
            alert("Your total score is: " + score);
        }
    
        // Function to display assessment results
        function displayResults() {
            const results = JSON.parse(localStorage.getItem('assessmentResults')) || [];
            const resultString = results.map(result => `${result.assessment}: ${result.result}`).join('\n');
            alert(resultString);
        }
    
        // Function to enable buttons once all assessments are completed
        function enableButtons() {
    document.getElementById('goToAdditional').disabled = false;
    document.getElementById('goToKnowledgeQuest').disabled = false;
}

        // Function to reset the progress bar and assessments on page load
        function resetProgress() {
    assessmentsCompleted = 0;
    completedAssessments.clear();
    updateProgressBar();

    // Disable buttons again
    document.getElementById('goToAdditional').disabled = true;
    document.getElementById('goToKnowledgeQuest').disabled = true;
}

        // Handle button click
        function handleButtonClick(event) {
            const button = event.target;
            if (button.disabled) {
                alert("You must complete all assessments before accessing this option.");
            } else {
                console.log("Button is enabled, proceeding...");
            }
        }
    
       // Function to reset specific elements on the page
function resetPage() {
    // Reset form elements (if any) to their default values
    const forms = document.querySelectorAll("form");
    forms.forEach(form => form.reset()); // Reset the form to its default values

    // Reset progress bar (assuming a specific progress bar element)
    const progressBar = document.querySelector("#progressBar");
    if (progressBar) {
        progressBar.style.width = "0%"; // Reset progress bar to 0%
    }

    // Reset input fields (text inputs, checkboxes, radio buttons, etc.)
    const inputs = document.querySelectorAll("input, textarea, select");
    inputs.forEach(input => {
        if (input.type === "checkbox" || input.type === "radio") {
            input.checked = false; // Uncheck checkboxes and radio buttons
        } else {
            input.value = ""; // Clear text fields and textarea
        }
    });

    // Reset buttons: Make sure buttons are in their default state (enabled)
    const buttons = document.querySelectorAll(".button");
    buttons.forEach(button => {
        button.disabled = false; // Enable buttons if they were disabled
    });
}

// Function to handle redirection when buttons are clicked
function handleRedirection(event) {
    const buttonId = event.target.id;

    if (buttonId === 'goToAdditional') {
        // Redirect to the Additional Assessment page
        window.location.href = "Additional-assessment.html"; // Change this URL to the correct one
    } else if (buttonId === 'goToKnowledgeQuest') {
        // Redirect to the Knowledge Quest page
        window.location.href = "multiple-choice.html"; // Change this URL to the correct one
    }
}

// Function to handle button click
function handleButtonClick(event) {
    // Add any specific logic you want to run when a button is clicked
    console.log(`${event.target.id} button clicked`);
}

// Attach event listeners to buttons after the page has loaded
window.onload = function () {
    resetPage(); // Call reset function to reset the page when it loads

    const buttons = document.querySelectorAll(".button");

    buttons.forEach(button => {
        button.addEventListener("click", event => {
            handleButtonClick(event);  // Handle button-specific logic
            handleRedirection(event);  // Redirect when needed
        });
    });
};

    </script>
    
</body>
</html>
